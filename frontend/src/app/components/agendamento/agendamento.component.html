<div class="container">
    <!-- BARRA LATERAL -->
    <app-barra-lateral></app-barra-lateral>

    <!-- CONTE√öDO PRINCIPAL -->
    <main>
        <h2>Agenda de Servi√ßos</h2>

        <div class="calendar-container">
            <full-calendar [options]="calendarOptions"></full-calendar>
        </div>

        <dialog id="modal-agendamento" #modalAgendamento>
            <h3>Novo Agendamento</h3>

            <form #formAppointment="ngForm" autocomplete="on">
                <label>Cliente:</label>
                <div class="autocomplete">
                    <input type="text" [(ngModel)]="novoAppointmentForm.clienteNome" name="clientNome"
                        (input)="filterClients()" (focus)="focusClients()" (blur)="hideClientDropdown()"
                        placeholder="Digite o nome do cliente" required />
                    <ul class="dropdown" *ngIf="showClientDropdown">
                        <li *ngFor="let c of filteredClients" (mousedown)="selectClient(c)">
                            {{ c.nome }}<span class="phone" *ngIf="c.telefone"> ‚Äî {{ c.telefone }}</span>
                        </li>
                        <li *ngIf="filteredClients.length === 0" class="empty">Nenhum cliente encontrado</li>
                    </ul>
                </div>

                <label>Profissional:</label>
                <div class="autocomplete">
                    <input type="text" [(ngModel)]="novoAppointmentForm.usuarioNome" name="professionalNome"
                        (input)="filterProfessionals()" (focus)="focusProfessionals()"
                        (blur)="hideProfessionalDropdown()" placeholder="Digite o nome do profissional" required />
                    <ul class="dropdown" *ngIf="showProfessionalDropdown">
                        <li *ngFor="let p of filteredProfessionals" (mousedown)="selectProfessional(p)">{{ p.nome }}
                        </li>
                        <li *ngIf="filteredProfessionals.length === 0" class="empty">Nenhum profissional encontrado</li>
                    </ul>
                </div>

                <label>Servi√ßo:</label>
                <div class="autocomplete">
                    <input type="text" [(ngModel)]="novoAppointmentForm.servicoNome" name="serviceNome"
                        (input)="filterServices()" (focus)="focusServices()" (blur)="hideServiceDropdown()"
                        placeholder="Digite o nome do servi√ßo" required />
                    <ul class="dropdown" *ngIf="showServiceDropdown">
                        <li *ngFor="let s of filteredServices" (mousedown)="selectService(s)">{{ s.nome }}</li>
                        <li *ngIf="filteredServices.length === 0" class="empty">Nenhum servi√ßo encontrado</li>
                    </ul>
                </div>

                <label>In√≠cio:</label>
                <input type="datetime-local" [(ngModel)]="novoAppointmentForm.data_hora_inicio" name="start_at"
                    required>

                <label>T√©rmino:</label>
                <input type="datetime-local" [(ngModel)]="novoAppointmentForm.data_hora_fim" name="end_at" required>

                <label>Status:</label>
                <select [(ngModel)]="novoAppointmentForm.status" name="status">
                    <option value="CONFIRMADO">Confirmado</option>
                    <option value="REMARCADO">Remarcado</option>
                    <option value="CANCELADO">Cancelado</option>
                </select>

                <label>Observa√ß√µes:</label>
                <textarea [(ngModel)]="novoAppointmentForm.observacoes" name="observacoes"></textarea>

                <button type="button" (click)="salvarAppointment()">Salvar</button>
                <button type="button" (click)="fecharModal()">Cancelar</button>
            </form>
        </dialog>

        <dialog #modalVisualizar class="modal-visualizar">
            <button class="btn-close-modal" (click)="fecharModalVisualizar()" aria-label="Fechar"> ‚úï </button>

            <h3>üìÖ Detalhes do Agendamento</h3>

            <div *ngIf="selectedAppointment">
                <p><strong>Cliente:</strong> {{ selectedAppointment.cliente }}</p>
                <p><strong>Profissional:</strong> {{ selectedAppointment.profissional }}</p>
                <p><strong>Servi√ßo:</strong> {{ selectedAppointment.servico }}</p>
                <p><strong>In√≠cio:</strong> {{ selectedAppointment.inicio }}</p>
                <p><strong>Fim:</strong> {{ selectedAppointment.fim }}</p>
                <p><strong>Status:</strong> {{ selectedAppointment.status }}</p>
                <p><strong>Observa√ß√µes:</strong> {{ selectedAppointment.observacoes }}</p>
            </div>

            <div class="appointment-complete">
                <label>
                    <input #concluidoCheckbox type="checkbox" 
                        [checked]="selectedAppointment?.status === 'CONCLUIDO'"
                        (change)="toggleConcluido(concluidoCheckbox.checked)" />
                    Conclu√≠do
                </label>
            </div>

            <button (click)="reagendarAppointment()" class="btn btn-primary">
                Reagendar
            </button>

            <button *ngIf="selectedAppointment?.status !== 'CANCELADO'" type="button" (click)="cancelarAppointment()"
                class="cancelar-btn">
                Cancelar Agendamento
            </button>
        </dialog>
    </main>
</div>